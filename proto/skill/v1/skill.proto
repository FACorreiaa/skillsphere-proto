syntax = "proto3";

package skillsphere.skill.v1;

import "common/v1/common.proto";
import "buf/validate/validate.proto";

option go_package = "github.com/FACorreiaa/skillsphere-proto/gen/go/skill/v1;skillv1";

// SkillService manages the skills catalog and user skill associations
service SkillService {
  // Create a new skill in the catalog
  rpc CreateSkill(CreateSkillRequest) returns (CreateSkillResponse);

  // Get skill by ID
  rpc GetSkill(GetSkillRequest) returns (GetSkillResponse);

  // List all skills with pagination
  rpc ListSkills(ListSkillsRequest) returns (ListSkillsResponse);

  // Update skill information
  rpc UpdateSkill(UpdateSkillRequest) returns (UpdateSkillResponse);

  // Delete skill from catalog
  rpc DeleteSkill(DeleteSkillRequest) returns (DeleteSkillResponse);

  // Add skill to user profile (offered or wanted)
  rpc AddUserSkill(AddUserSkillRequest) returns (AddUserSkillResponse);

  // Remove skill from user profile
  rpc RemoveUserSkill(RemoveUserSkillRequest) returns (RemoveUserSkillResponse);

  // Update user skill proficiency
  rpc UpdateUserSkill(UpdateUserSkillRequest) returns (UpdateUserSkillResponse);

  // Get all skills for a user
  rpc GetUserSkills(GetUserSkillsRequest) returns (GetUserSkillsResponse);

  // Get trending skills
  rpc GetTrendingSkills(GetTrendingSkillsRequest) returns (GetTrendingSkillsResponse);

  // Search skills by keyword
  rpc SearchSkills(SearchSkillsRequest) returns (SearchSkillsResponse);

  // Get skill suggestions based on user profile
  rpc GetSkillSuggestions(GetSkillSuggestionsRequest) returns (GetSkillSuggestionsResponse);
}

// ============================================================================
// Create Skill
// ============================================================================

message CreateSkillRequest {
  string name = 1 [
    (buf.validate.field).string = {
      min_len: 1
      max_len: 100
    }
  ];
  skillsphere.common.v1.SkillCategory category = 2 [
    (buf.validate.field).enum.defined_only = true
  ];
  string description = 3 [
    (buf.validate.field).string.max_len = 2000
  ];
  repeated string tags = 4 [
    (buf.validate.field).repeated.max_items = 25,
    (buf.validate.field).repeated.items = {
      string: {
        min_len: 1
        max_len: 32
      }
    }
  ];
}

message CreateSkillResponse {
  skillsphere.common.v1.Skill skill = 1;
}

// ============================================================================
// Get Skill
// ============================================================================

message GetSkillRequest {
  string skill_id = 1 [
    (buf.validate.field).string = {
      min_len: 1
      max_len: 50
    }
  ];
}

message GetSkillResponse {
  skillsphere.common.v1.Skill skill = 1;
  SkillStats stats = 2;
}

message SkillStats {
  int32 total_users_offering = 1 [(buf.validate.field).int32.gte = 0];
  int32 total_users_wanting = 2 [(buf.validate.field).int32.gte = 0];
  int32 total_sessions = 3 [(buf.validate.field).int32.gte = 0];
  double average_proficiency = 4 [
    (buf.validate.field).double = {
      gte: 0
      lte: 10
    }
  ];
}

// ============================================================================
// List Skills
// ============================================================================

message ListSkillsRequest {
  int32 page_size = 1 [
    (buf.validate.field).int32 = {
      gte: 1
      lte: 100
    }
  ];
  string page_token = 2 [
    (buf.validate.field).string.max_len = 256
  ];
  repeated skillsphere.common.v1.SkillCategory categories = 3 [
    (buf.validate.field).repeated.max_items = 10
  ];
  string sort_by = 4 [                  // "name", "popularity", "created_at"
    (buf.validate.field).string.max_len = 20
  ];
}

message ListSkillsResponse {
  repeated skillsphere.common.v1.Skill skills = 1;
  string next_page_token = 2 [
    (buf.validate.field).string.max_len = 256
  ];
  int32 total_count = 3 [
    (buf.validate.field).int32.gte = 0
  ];
}

// ============================================================================
// Update Skill
// ============================================================================

message UpdateSkillRequest {
  skillsphere.common.v1.Skill skill = 1 [(buf.validate.field).required = true];
}

message UpdateSkillResponse {
  skillsphere.common.v1.Skill skill = 1;
}

// ============================================================================
// Delete Skill
// ============================================================================

message DeleteSkillRequest {
  string skill_id = 1 [
    (buf.validate.field).string = {
      min_len: 1
      max_len: 50
    }
  ];
}

message DeleteSkillResponse {
  bool success = 1;
}

// ============================================================================
// Add User Skill
// ============================================================================

message AddUserSkillRequest {
  string user_id = 1 [
    (buf.validate.field).string = {
      min_len: 1
      max_len: 50
    }
  ];
  string skill_id = 2 [
    (buf.validate.field).string = {
      min_len: 1
      max_len: 50
    }
  ];
  int32 proficiency_level = 3 [         // 1-10
    (buf.validate.field).int32 = {
      gte: 1
      lte: 10
    }
  ];
  bool is_offered = 4;                  // true = offering, false = wanting
  string experience_description = 5 [
    (buf.validate.field).string.max_len = 1000
  ];
}

message AddUserSkillResponse {
  skillsphere.common.v1.UserSkill user_skill = 1;
}

// ============================================================================
// Remove User Skill
// ============================================================================

message RemoveUserSkillRequest {
  string user_id = 1 [
    (buf.validate.field).string = {
      min_len: 1
      max_len: 50
    }
  ];
  string skill_id = 2 [
    (buf.validate.field).string = {
      min_len: 1
      max_len: 50
    }
  ];
  bool is_offered = 3;
}

message RemoveUserSkillResponse {
  bool success = 1;
}

// ============================================================================
// Update User Skill
// ============================================================================

message UpdateUserSkillRequest {
  string user_id = 1 [
    (buf.validate.field).string = {
      min_len: 1
      max_len: 50
    }
  ];
  string skill_id = 2 [
    (buf.validate.field).string = {
      min_len: 1
      max_len: 50
    }
  ];
  int32 proficiency_level = 3 [
    (buf.validate.field).int32 = {
      gte: 1
      lte: 10
    }
  ];
  string experience_description = 4 [
    (buf.validate.field).string.max_len = 1000
  ];
  bool is_offered = 5;
}

message UpdateUserSkillResponse {
  skillsphere.common.v1.UserSkill user_skill = 1;
}

// ============================================================================
// Get User Skills
// ============================================================================

message GetUserSkillsRequest {
  string user_id = 1 [
    (buf.validate.field).string = {
      min_len: 1
      max_len: 50
    }
  ];
  bool offered_only = 2;                // Filter for offered skills
  bool wanted_only = 3;                 // Filter for wanted skills
}

message GetUserSkillsResponse {
  repeated skillsphere.common.v1.UserSkill skills_offered = 1;
  repeated skillsphere.common.v1.UserSkill skills_wanted = 2;
}

// ============================================================================
// Get Trending Skills
// ============================================================================

message GetTrendingSkillsRequest {
  int32 limit = 1 [
    (buf.validate.field).int32 = {
      gte: 1
      lte: 50
    }
  ];                      // Default 10, max 50
  skillsphere.common.v1.SkillCategory category = 2;
  int32 days = 3 [                      // Trending window (default 7)
    (buf.validate.field).int32 = {
      gte: 1
      lte: 30
    }
  ];
}

message GetTrendingSkillsResponse {
  repeated TrendingSkill skills = 1;
}

message TrendingSkill {
  skillsphere.common.v1.Skill skill = 1;
  int32 popularity_score = 2 [(buf.validate.field).int32.gte = 0];
  int32 sessions_last_period = 3 [(buf.validate.field).int32.gte = 0];
  double growth_rate = 4 [              // Percentage growth
    (buf.validate.field).double = {
      gte: -100
      lte: 100
    }
  ];
}

// ============================================================================
// Search Skills
// ============================================================================

message SearchSkillsRequest {
  string query = 1 [                    // Keyword search
    (buf.validate.field).string = {
      min_len: 1
      max_len: 200
    }
  ];
  repeated skillsphere.common.v1.SkillCategory categories = 2 [
    (buf.validate.field).repeated.max_items = 10
  ];
  int32 limit = 3 [
    (buf.validate.field).int32 = {
      gte: 1
      lte: 100
    }
  ];
}

message SearchSkillsResponse {
  repeated skillsphere.common.v1.Skill skills = 1;
}

// ============================================================================
// Get Skill Suggestions
// ============================================================================

message GetSkillSuggestionsRequest {
  string user_id = 1 [
    (buf.validate.field).string = {
      min_len: 1
      max_len: 50
    }
  ];
  int32 limit = 2 [                     // Default 10
    (buf.validate.field).int32 = {
      gte: 1
      lte: 50
    }
  ];
}

message GetSkillSuggestionsResponse {
  repeated SkillSuggestion suggestions = 1;
}

message SkillSuggestion {
  skillsphere.common.v1.Skill skill = 1;
  string reason = 2 [                   // Why this is suggested
    (buf.validate.field).string.max_len = 500
  ];
  double relevance_score = 3 [          // 0.0-1.0
    (buf.validate.field).double = {
      gte: 0
      lte: 1
    }
  ];
}
