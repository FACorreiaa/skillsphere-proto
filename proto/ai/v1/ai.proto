syntax = "proto3";

package skillsphere.ai.v1;

import "google/protobuf/timestamp.proto";

option go_package = "github.com/FACorreiaa/skillsphere-proto/gen/go/ai/v1;aiv1";

// AIService provides LLM-powered features via Gemini integration
service AIService {
  // Generate skill embeddings for semantic matching
  rpc GenerateSkillEmbedding(GenerateSkillEmbeddingRequest) returns (GenerateSkillEmbeddingResponse);

  // Get personalized skill roadmap
  rpc GetSkillRoadmap(GetSkillRoadmapRequest) returns (GetSkillRoadmapResponse);

  // Get AI mentor advice for sessions
  rpc GetMentorAdvice(GetMentorAdviceRequest) returns (GetMentorAdviceResponse);

  // Generate session prep tips
  rpc GenerateSessionPrep(GenerateSessionPrepRequest) returns (GenerateSessionPrepResponse);

  // Analyze skill gap between users
  rpc AnalyzeSkillGap(AnalyzeSkillGapRequest) returns (AnalyzeSkillGapResponse);

  // Generate learning resources
  rpc GenerateLearningResources(GenerateLearningResourcesRequest) returns (GenerateLearningResourcesResponse);

  // Chat with AI mentor (conversational)
  rpc ChatWithMentor(ChatWithMentorRequest) returns (ChatWithMentorResponse);

  // Stream chat responses (for real-time conversation)
  rpc StreamMentorChat(StreamMentorChatRequest) returns (stream StreamMentorChatResponse);

  // Generate skill assessment questions
  rpc GenerateAssessment(GenerateAssessmentRequest) returns (GenerateAssessmentResponse);

  // Analyze user progress
  rpc AnalyzeProgress(AnalyzeProgressRequest) returns (AnalyzeProgressResponse);
}

// ============================================================================
// Enums
// ============================================================================

enum AIModel {
  AI_MODEL_UNSPECIFIED = 0;
  AI_MODEL_GEMINI_PRO = 1;
  AI_MODEL_GEMINI_ULTRA = 2;
  AI_MODEL_GEMINI_EMBEDDING = 3;
}

enum DifficultyLevel {
  DIFFICULTY_LEVEL_UNSPECIFIED = 0;
  DIFFICULTY_LEVEL_BEGINNER = 1;
  DIFFICULTY_LEVEL_INTERMEDIATE = 2;
  DIFFICULTY_LEVEL_ADVANCED = 3;
}

// ============================================================================
// Generate Skill Embedding
// ============================================================================

message GenerateSkillEmbeddingRequest {
  repeated string skill_names = 1;
  string context = 2;                        // Optional context for better embeddings
}

message GenerateSkillEmbeddingResponse {
  repeated SkillEmbedding embeddings = 1;
}

message SkillEmbedding {
  string skill_name = 1;
  repeated float vector = 2;                 // 768D vector from Gemini
  string model_version = 3;
  google.protobuf.Timestamp generated_at = 4;
}

// ============================================================================
// Get Skill Roadmap
// ============================================================================

message GetSkillRoadmapRequest {
  string user_id = 1;
  string target_skill = 2;
  repeated string current_skills = 3;        // User's existing skills
  DifficultyLevel target_level = 4;
  int32 timeline_weeks = 5;                  // Desired timeline
}

message GetSkillRoadmapResponse {
  repeated RoadmapStep steps = 1;
  int32 estimated_hours = 2;
  repeated string prerequisites = 3;
  string summary = 4;
}

message RoadmapStep {
  int32 order = 1;
  string title = 2;
  string description = 3;
  repeated string topics = 4;
  int32 estimated_hours = 5;
  repeated LearningResource resources = 6;
  repeated string milestones = 7;
}

message LearningResource {
  string title = 1;
  string url = 2;
  string type = 3;                           // "video", "article", "course", "book"
  int32 duration_minutes = 4;
  bool is_free = 5;
}

// ============================================================================
// Get Mentor Advice
// ============================================================================

message GetMentorAdviceRequest {
  string user_id = 1;
  string skill_name = 2;
  string context = 3;                        // e.g., "preparing for session on React hooks"
  repeated string specific_questions = 4;
}

message GetMentorAdviceResponse {
  string advice = 1;
  repeated string key_points = 2;
  repeated string do_list = 3;               // What to do
  repeated string dont_list = 4;             // What to avoid
  repeated LearningResource resources = 5;
}

// ============================================================================
// Generate Session Prep
// ============================================================================

message GenerateSessionPrepRequest {
  string session_id = 1;
  string user_id = 2;
  repeated string skills_to_teach = 3;
  repeated string skills_to_learn = 4;
  int32 session_duration_minutes = 5;
}

message GenerateSessionPrepResponse {
  string agenda = 1;
  repeated string teaching_tips = 2;
  repeated string learning_goals = 3;
  repeated string discussion_topics = 4;
  repeated string practice_exercises = 5;
  string icebreaker = 6;                     // Conversation starter
}

// ============================================================================
// Analyze Skill Gap
// ============================================================================

message AnalyzeSkillGapRequest {
  string user_id_1 = 1;
  string user_id_2 = 2;
  repeated string focus_skills = 3;          // Optional filter
}

message AnalyzeSkillGapResponse {
  repeated SkillGap gaps = 1;
  string summary = 2;
  repeated string recommendations = 3;
}

message SkillGap {
  string skill_name = 1;
  int32 user1_proficiency = 2;
  int32 user2_proficiency = 3;
  int32 gap_size = 4;                        // Absolute difference
  bool is_complementary = 5;                 // One teaches, other learns
  string explanation = 6;
}

// ============================================================================
// Generate Learning Resources
// ============================================================================

message GenerateLearningResourcesRequest {
  string skill_name = 1;
  DifficultyLevel level = 2;
  repeated string preferred_formats = 3;     // "video", "article", "interactive"
  bool free_only = 4;
}

message GenerateLearningResourcesResponse {
  repeated LearningResource resources = 1;
  string learning_path = 2;                  // Suggested order
}

// ============================================================================
// Chat With Mentor
// ============================================================================

message ChatWithMentorRequest {
  string user_id = 1;
  string session_id = 2;                     // Optional for context
  string message = 3;
  repeated ChatMessage history = 4;          // Conversation history
}

message ChatWithMentorResponse {
  string response = 1;
  repeated string follow_up_suggestions = 2;
}

message ChatMessage {
  string role = 1;                           // "user" or "assistant"
  string content = 2;
  google.protobuf.Timestamp timestamp = 3;
}

// ============================================================================
// Stream Mentor Chat
// ============================================================================

message StreamMentorChatRequest {
  string user_id = 1;
  string message = 2;
  repeated ChatMessage history = 3;
}

message StreamMentorChatResponse {
  string chunk = 1;                          // Partial response
  bool is_complete = 2;
}

// ============================================================================
// Generate Assessment
// ============================================================================

message GenerateAssessmentRequest {
  string skill_name = 1;
  DifficultyLevel level = 2;
  int32 question_count = 3;                  // Default 10
  string format = 4;                         // "multiple_choice", "coding", "essay"
}

message GenerateAssessmentResponse {
  repeated AssessmentQuestion questions = 1;
  int32 estimated_minutes = 2;
}

message AssessmentQuestion {
  int32 question_number = 1;
  string question = 2;
  repeated string options = 3;               // For multiple choice
  string correct_answer = 4;
  string explanation = 5;
  int32 difficulty_score = 6;                // 1-10
}

// ============================================================================
// Analyze Progress
// ============================================================================

message AnalyzeProgressRequest {
  string user_id = 1;
  string skill_id = 2;
  google.protobuf.Timestamp start_date = 3;
  google.protobuf.Timestamp end_date = 4;
}

message AnalyzeProgressResponse {
  string summary = 1;
  repeated ProgressInsight insights = 2;
  double progress_percentage = 3;
  repeated string strengths = 4;
  repeated string areas_to_improve = 5;
  repeated string next_steps = 6;
}

message ProgressInsight {
  string category = 1;                       // "sessions", "practice", "consistency"
  string metric = 2;
  string trend = 3;                          // "improving", "declining", "stable"
  string explanation = 4;
}
